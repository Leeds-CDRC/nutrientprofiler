<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nutrientprofiler">
<title>Nutrient Profile Model Scoring • nutrientprofiler</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nutrient Profile Model Scoring">
<meta property="og:description" content="nutrientprofiler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nutrientprofiler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nutrientprofiler.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/nutrientprofile_assessment.html">Nutrient Profile Model Assessment</a>
    <a class="dropdown-item" href="../articles/nutrientprofile_scoring.html">Nutrient Profile Model Scoring</a>
    <a class="dropdown-item" href="../articles/specific_gravity.html">Specific Gravity Adjustment</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Leeds-CDRC/nutrientprofiler/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Nutrient Profile Model Scoring</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Leeds-CDRC/nutrientprofiler/blob/HEAD/vignettes/nutrientprofile_scoring.Rmd" class="external-link"><code>vignettes/nutrientprofile_scoring.Rmd</code></a></small>
      <div class="d-none name"><code>nutrientprofile_scoring.Rmd</code></div>
    </div>

    
    
<p>To determine the individual nutritional element scores that can be
used in a Nutrient Profile Model there are two crucial steps:</p>
<ul>
<li>Adjust the nutritional value based on the specific gravity adjusted
weight and any unit transformations required</li>
<li>Score the adjusted nutritional value based on a set of
thresholds</li>
</ul>
<p>Below we outline the underlying logic for implementing both these
steps in the <code>nutrientprofiler</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://leeds-cdrc.github.io/nutrientprofiler/">nutrientprofiler</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="adjuster-functions">Adjuster functions<a class="anchor" aria-label="anchor" href="#adjuster-functions"></a>
</h2>
<p>Nutritional values need to be adjusted before scoring to ensure:</p>
<ul>
<li>The nutritional information is adjusted based on their nutrient
denisty which is standardised to 100g of the product rather than the
total amount to enable better comparisons between products</li>
<li>They are converted into the appropriate unit for scoring
thresholds</li>
</ul>
<p>All adjuster functions are built ontop of the
<code>generic_adjuster</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generic_adjuster.html">generic_adjuster</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 66.66667</span></span></code></pre></div>
<p>This takes a <code>value</code> argument for the amount of a
nutritional category and divides it by the second argument
<code>adjusted_weight</code> which corresponds to the specific gravity
adjusted weight/volume for the product as determined using the specific
gravity functions above. The output of this is multiplied by 100 to give
the final adjusted value.</p>
<div class="section level3">
<h3 id="energy-and-salt-adjustments">Energy and salt adjustments<a class="anchor" aria-label="anchor" href="#energy-and-salt-adjustments"></a>
</h3>
<p>This is enough for adjusting most nutritional values but for both
energy and salt we need additional steps to properly adjust the value
for the appropriate units. This is because for energy nutritional
information can be in either <em>kcal</em> or <em>kJ</em> and for salt
can either be listed as a sodium measurement in <em>mg</em> or a salt
measurement in <em>g</em>. The scoring thresholds for the Nutrient
Profile Model are specified for <em>kJ</em> for energy and <em>mg</em>
of sodium for salt so additional steps are needed to properly adjust
these values if present in the alternate unit.</p>
<p>This is handled by specific adjuster functions for energy and salt
that also take an <code>adjuster_type</code> argument to specify the
units of the passed value.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for energy in kj</span></span>
<span><span class="fu"><a href="../reference/energy_value_adjuster.html">energy_value_adjuster</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">80</span>, adjuster_type<span class="op">=</span><span class="st">"kj"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12.5</span></span>
<span></span>
<span><span class="co"># for energy in kcal</span></span>
<span><span class="fu"><a href="../reference/energy_value_adjuster.html">energy_value_adjuster</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">300</span>, adjuster_type<span class="op">=</span><span class="st">"kj"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span></span>
<span><span class="co"># for salt in grams</span></span>
<span><span class="fu"><a href="../reference/salt_adjuster.html">salt_adjuster</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">100</span>, adjuster_type<span class="op">=</span><span class="st">"salt"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 30</span></span>
<span></span>
<span><span class="co"># for salt in mg of sodium</span></span>
<span><span class="fu"><a href="../reference/salt_adjuster.html">salt_adjuster</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">100</span>, adjuster_type<span class="op">=</span><span class="st">"sodium"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 60</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="scoring-function">Scoring function<a class="anchor" aria-label="anchor" href="#scoring-function"></a>
</h2>
<p>The adjuster functions return an adjusted value for nutritional
information to ensure we can calculate the NPM Score based on 100g of
the product. We use this adjusted value in the subsequent step for
actually calculating a score for each of our nutrient groups. This is
performed using the <code>NPM_score_function</code> which acts as a
dispatcher function that takes <code>value</code> and <code>type</code>
arguments to determine which adjustment function to call and which
scoring thresholds to use. This function also takes optional additional
arguments such as specifying the <code>adjusted_weight</code> that can
be passed into the adjuster functions and the <code>adjuster_type</code>
argument for some types such as <code>energy</code> and
<code>salt</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate a score for a protein value</span></span>
<span><span class="fu"><a href="../reference/NPM_score_function.html">NPM_score_function</a></span><span class="op">(</span><span class="fl">80</span>, adjusted_weight<span class="op">=</span><span class="fl">100</span>, <span class="st">"protein"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>Under the hood this function is calling the
<code>generic_adjuster</code> from above to adjust the nutritional value
using the <code>adjusted_weight</code>, next it passes this adjusted
value to the <code>scoring_function</code>. The
<code>scoring_function</code> determines the score of a value based on
provided score thresholds.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create thesholds vector from largest to smallest</span></span>
<span><span class="va">THRESHOLDS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># score the value 1 against the provided thresholds</span></span>
<span><span class="co"># returns 0</span></span>
<span><span class="fu"><a href="../reference/scoring_function.html">scoring_function</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">THRESHOLDS</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># returns 2</span></span>
<span><span class="fu"><a href="../reference/scoring_function.html">scoring_function</a></span><span class="op">(</span><span class="fl">2.1</span>, <span class="va">THRESHOLDS</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>The <code>scoring_function</code> behaves by taking a vector of
thresholds in descending order. First it sets the score to be the total
number of thresholds available (i.e. 3 in the above example). It takes
the value we have provided and checks if this value is greater than each
item in the thresholds vector, if it is greater than the item from
thresholds it returns the score corresponding to that item. If the value
isn’t greater than the item then the score, set earlier, is deducted 1.
The continues for each item in the thresholds until the only option left
is our value not being greater than the final item in our thresholds
leading to a score of 0.</p>
<div class="section level3">
<h3 id="fruit-vegetables-and-nuts-scoring">Fruit, vegetables and nuts scoring<a class="anchor" aria-label="anchor" href="#fruit-vegetables-and-nuts-scoring"></a>
</h3>
<p>The one exception to this scoring function is for fruit, vegetables
and nuts. This nutritional information is presented as a percentage and
the scoring for this specified in the Nutrient Profile Model doesn’t
score this in a continuous manner so this package includes a specific
<code>fruit_veg_nut_scorer</code>. This function takes value and returns
a score (either 0, 1, 2 or 5) depending on if the value meets a specific
percentage threshold.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># scores a 5</span></span>
<span><span class="fu"><a href="../reference/fruit_veg_nut_scorer.html">fruit_veg_nut_scorer</a></span><span class="op">(</span><span class="fl">81</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="co"># scores a 2</span></span>
<span><span class="fu"><a href="../reference/fruit_veg_nut_scorer.html">fruit_veg_nut_scorer</a></span><span class="op">(</span><span class="fl">70</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span></span>
<span><span class="co"># scores a 1</span></span>
<span><span class="fu"><a href="../reference/fruit_veg_nut_scorer.html">fruit_veg_nut_scorer</a></span><span class="op">(</span><span class="fl">45</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># scores a 0</span></span>
<span><span class="fu"><a href="../reference/fruit_veg_nut_scorer.html">fruit_veg_nut_scorer</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alex Coleman, Vicki Jenneson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
