<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nutrientprofiler">
<title>Introduction to nutrientprofiler • nutrientprofiler</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to nutrientprofiler">
<meta property="og:description" content="nutrientprofiler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nutrientprofiler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/nutrientprofiler.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/nutrientprofile_assessment.html">Nutrient Profile Model Assessment</a>
    <a class="dropdown-item" href="../articles/nutrientprofile_scoring.html">Nutrient Profile Model Scoring</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Leeds-CDRC/nutrientprofiler/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="nutrientprofiler_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="nutrientprofiler_files/d3-3.3.8/d3.min.js"></script><script src="nutrientprofiler_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="nutrientprofiler_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="nutrientprofiler_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="nutrientprofiler_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="nutrientprofiler_files/chromatography-0.1/chromatography.js"></script><script src="nutrientprofiler_files/DiagrammeR-binding-1.0.9/DiagrammeR.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to nutrientprofiler</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Leeds-CDRC/nutrientprofiler/blob/HEAD/vignettes/nutrientprofiler.Rmd" class="external-link"><code>vignettes/nutrientprofiler.Rmd</code></a></small>
      <div class="d-none name"><code>nutrientprofiler.Rmd</code></div>
    </div>

    
    
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><p>The <code>nutrientprofiler</code> package aims to provide a series of
R functions that implement UK Nutrient Profiling Model scoring that can
be applied across product datasets.</p>
<p>This is broken up into 3 parts within the package:</p>
<ul>
<li>Specific gravity conversions</li>
<li>Scoring the different nutritional components of the NPM score</li>
<li>Calculating the NPM score and NPM assessment logic</li>
</ul>
<p>To start we load the package the with command below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://leeds-cdrc.github.io/nutrientprofiler/">nutrientprofiler</a></span><span class="op">)</span></span></code></pre></div>
<p>We can also load some example data to help us with the following
examples. This data was created specifically for this package and so is
potentially quite different to how your real world data might look.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cdrcdrinks</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 21</span></span>
<span><span class="va">cdrcdrinks</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;     name brand product_category product_type food_type drink_format drink_type</span></span>
<span><span class="co">#&gt; 1 lembas    NA               NA         Food                                  </span></span>
<span><span class="co">#&gt;   nutrition_info energy_measurement_kj energy_measurement_kcal</span></span>
<span><span class="co">#&gt; 1                                  266                      NA</span></span>
<span><span class="co">#&gt;   sugar_measurement_g fat_measurement_g salt_measurement_g</span></span>
<span><span class="co">#&gt; 1                  50                 3                 NA</span></span>
<span><span class="co">#&gt;   sodium_measurement_mg fibre_measurement_nsp fibre_measurement_aoac</span></span>
<span><span class="co">#&gt; 1                   0.6                     3                     NA</span></span>
<span><span class="co">#&gt;   protein_measurement_g fruit_nut_measurement_percent weight_g volume_ml</span></span>
<span><span class="co">#&gt; 1                     7                             0      100        NA</span></span>
<span><span class="co">#&gt;   volume_water_ml</span></span>
<span><span class="co">#&gt; 1              NA</span></span></code></pre></div>
<div class="section level2">
<h2 id="specific-gravity-conversions">Specific gravity conversions<a class="anchor" aria-label="anchor" href="#specific-gravity-conversions"></a>
</h2>
<p>When trying to determine the NPM score the volume or weight of the
product needs to be adjusted to account for it’s specific gravity.</p>
<p>To adjust product weights or volumes for specific gravity we use the
<code>SGConverter</code> function. This is a high level function that is
designed to operate on each row of a data.frame parsing multiple columns
to determine how to calculate the adjusted specific gravity score.</p>
<blockquote>
<p>!:warning: The <code>SGConverter</code> function has been
specifically designed with an existing dataset in mind and expects
specific column names to work.</p>
</blockquote>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using dplyr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="va">cdrcdrinks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>out <span class="op">=</span> <span class="fu"><a href="../reference/SGConverter.html">SGConverter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;      out</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 130  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 104  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 129. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 103  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  51.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  25  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 124. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 109</span></span>
<span></span>
<span><span class="co"># using base R</span></span>
<span><span class="va">cdrcdrinks</span><span class="op">[</span><span class="st">"sg"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cdrcdrinks</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="../reference/SGConverter.html">SGConverter</a></span><span class="op">(</span><span class="va">cdrcdrinks</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The below figure attempts to outline the hierarchy of function calls
that <code>SGConverter</code> initiates. The logic for determining how
to adjust values for specific gravity is complicated by the potential
options around whether a drink is ready-to-drink, a powdered
preparation, or a cordial, within both the powdered and cordial options
additional consideration must be given to the preparation instructions
that are provided. In the below figure each function is named in each
node and each column name the function uses to dispatch to underlying
functions is specified in single quotes. If a function returns a value
it is marked with an empty diamond.</p>
<div class="figure" style="text-align: center">
<div class="DiagrammeR html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e64451c4e3a1414edd1e" style="width:960px;height:576px;"></div>
<script type="application/json" data-for="htmlwidget-e64451c4e3a1414edd1e">{"x":{"diagram":"\ngraph TB;\n  1(SGConverter<br>'product_type') --> 2(sg_food_converter<br>'weight_g');\n  1 --> 3(sg_drink_converter<br>'drink_format');\n  3 --> 4(sg_ready_drink_converter<br>'drink_type');\n  3 --> 5(sg_powd_drink_converter<br>'nutrition_info');\n  3 --> 6(sg_cord_drink_converter<br>'nutrition_info');\n  6 --> 7{ };\n  2 --> 10{ };\n  2 --> 11(sg_liquidfood_converter<br>'food_type');\n  11 --> 13{ };\n  4 --> 14{ };\n  5 --> 16{ };\n"},"evals":[],"jsHooks":[]}</script><p class="caption">
SGConverter logic
</p>
</div>
</div>
<div class="section level2">
<h2 id="nutrient-profile-model-scoring">Nutrient profile model scoring<a class="anchor" aria-label="anchor" href="#nutrient-profile-model-scoring"></a>
</h2>
<p>The next part of this package is a series of functions for handling
Nutrient Profile Model scoring. These specifically look at functions for
adjusting units into the expected unit as documented for the <a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/216094/dh_123492.pdf" class="external-link">Nutrient
Profile Model</a>, a generic scoring function for returning a score for
a value given a number of thresholds, a scoring dispatcher function that
determines what adjuster and scoring thresholds to use for a given value
and a high level <code>NPMScore</code> wrapper function that shows the
logic for calculating the NPM score across multiple nutritional groups
for a data.frame of data.</p>
<p>A quick example of running <code>NPMScore</code> across a single row
of data is shown below:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/NPMScore.html">NPMScore</a></span><span class="op">(</span><span class="va">cdrcdrinks</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, sg_adjusted_label<span class="op">=</span><span class="st">"sg"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   energy_score sugar_score fat_score protein_score salt_score fvn_score</span></span>
<span><span class="co">#&gt; 1            0          10         2             4          0         0</span></span>
<span><span class="co">#&gt;   fibre_score</span></span>
<span><span class="co">#&gt; 1           4</span></span></code></pre></div>
<p>An example of building a tidyverse pipeline to calculate scores
across all rows of a data.frame using <code>NPMScore</code> and
<code>SGConverter</code> is shown below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdrcdrinks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> sg <span class="op">=</span> <span class="fu"><a href="../reference/SGConverter.html">SGConverter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>test <span class="op">=</span> <span class="fu"><a href="../reference/NPMScore.html">NPMScore</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, sg_adjusted_label<span class="op">=</span><span class="st">"sg"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">energy_score</span>, <span class="va">sugar_score</span>, <span class="va">salt_score</span>, <span class="va">fvn_score</span>,</span>
<span>  <span class="va">protein_score</span>, <span class="va">fat_score</span>, <span class="va">fibre_score</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    energy_score sugar_score salt_score fvn_score protein_score fat_score</span></span>
<span><span class="co">#&gt;           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>            0          10          0         0             4         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>            0           3          0         0             1         8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>            2           2          1         0             0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>            0           2          0         0             0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>            2           4          0         0             0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>            0           4          0         0             2        10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>            1           6          2         0             0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>            2          10          4         0             1         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>            2           3          0         0             0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>            2           3          0         0             0         0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: fibre_score &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="nutrient-profile-model-assessment">Nutrient Profile Model assessment<a class="anchor" aria-label="anchor" href="#nutrient-profile-model-assessment"></a>
</h2>
<p>After calculating the scores for specific nutrients for our product
next we need to perform the actual Nutrient Profile Model assessment.
This involves combining individual nutrient scores to calculate an A
score and a C score and use these compound to calculate a total Nutrient
Profile Model score and assess this to determine a pass or fail.</p>
<p>This package implements this logic in a high-level wrapper function
called <code>NPMAssess</code> which operates on a row of a data.frame.
It expects the columns generated in the previous <code>NPMScore</code>
step to allow it to calculate the A score and C score and can be used as
follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create NPM_score data.frame from NPMScore</span></span>
<span><span class="co"># using the specific gravity `sg` column created above</span></span>
<span><span class="va">npm_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>        <span class="st">"rbind"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cdrcdrinks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="../reference/NPMScore.html">NPMScore</a></span><span class="op">(</span><span class="va">cdrcdrinks</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, sg_adjusted_label <span class="op">=</span> <span class="st">"sg"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># append NPM Score columns to original data</span></span>
<span><span class="va">combo_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cdrcdrinks</span>, <span class="va">npm_scores</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test NPMAssess on this data</span></span>
<span><span class="fu"><a href="../reference/NPMAssess.html">NPMAssess</a></span><span class="op">(</span><span class="va">combo_df</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A_score C_score NPM_score NPM_assessment</span></span>
<span><span class="co">#&gt; 1      12       8         8           FAIL</span></span></code></pre></div>
<p>We can also use tidyverse functions to build an entire pipeline for
running Nutrient Profile Model assessments.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using tidyr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdrcdrinks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> sg <span class="op">=</span> <span class="fu"><a href="../reference/SGConverter.html">SGConverter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>test <span class="op">=</span> <span class="fu"><a href="../reference/NPMScore.html">NPMScore</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, sg_adjusted_label<span class="op">=</span><span class="st">"sg"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>assess <span class="op">=</span> <span class="fu"><a href="../reference/NPMAssess.html">NPMAssess</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">assess</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">product_type</span>, <span class="va">NPM_score</span>, <span class="va">NPM_assessment</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">#&gt;    product_type NPM_score NPM_assessment</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Food                 8 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Food                11 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Drink                5 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Drink                2 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Drink                6 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Food                14 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Drink                9 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Drink               16 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Drink                5 FAIL          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Drink                5 FAIL</span></span></code></pre></div>
<p>The building blocks of <code>NPMAssess</code> are explained in more
detail in the <a href="./nutrientprofile_assessment.Rmd">Nutrient
Profile Model Assessment vignette</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alex Coleman, Vicki Jenneson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
