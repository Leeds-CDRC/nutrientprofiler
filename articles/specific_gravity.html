<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nutrientprofiler">
<title>Specific Gravity Adjustment • nutrientprofiler</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Specific Gravity Adjustment">
<meta property="og:description" content="nutrientprofiler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nutrientprofiler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nutrientprofiler.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/nutrientprofile_assessment.html">Nutrient Profile Model Assessment</a>
    <a class="dropdown-item" href="../articles/nutrientprofile_scoring.html">Nutrient Profile Model Scoring</a>
    <a class="dropdown-item" href="../articles/specific_gravity.html">Specific Gravity Adjustment</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Leeds-CDRC/nutrientprofiler/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="specific_gravity_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="specific_gravity_files/d3-3.3.8/d3.min.js"></script><script src="specific_gravity_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="specific_gravity_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="specific_gravity_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="specific_gravity_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="specific_gravity_files/chromatography-0.1/chromatography.js"></script><script src="specific_gravity_files/DiagrammeR-binding-1.0.9/DiagrammeR.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Specific Gravity Adjustment</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Leeds-CDRC/nutrientprofiler/blob/HEAD/vignettes/specific_gravity.Rmd" class="external-link"><code>vignettes/specific_gravity.Rmd</code></a></small>
      <div class="d-none name"><code>specific_gravity.Rmd</code></div>
    </div>

    
    
<p>When attempting to calculate a Nutrient Profile Model volumes and
masses need to be adjusted by the specific gravity of the product to
ensure a correct reading. This is managed directly by the
<code>SGConverter</code> high level function that operates row-by-row on
a data.frame with a series of expected columns. This function is
composed of a series of different dispatcher function which will be
outlined below (see figure for hierarchy).</p>
<div class="figure" style="text-align: center">
<div class="DiagrammeR html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-de23fbd421a06b0df3de" style="width:960px;height:576px;"></div>
<script type="application/json" data-for="htmlwidget-de23fbd421a06b0df3de">{"x":{"diagram":"\ngraph TB;\n  1(SGConverter<br>'product_type') --> 2(sg_food_converter<br>'weight_g');\n  1 --> 3(sg_drink_converter<br>'drink_format');\n  3 --> 4(sg_ready_drink_converter<br>'drink_type');\n  3 --> 5(sg_powd_drink_converter<br>'nutrition_info');\n  3 --> 6(sg_cord_drink_converter<br>'nutrition_info');\n  6 --> 7{ };\n  2 --> 10{ };\n  2 --> 11(sg_liquidfood_converter<br>'food_type');\n  11 --> 13{ };\n  4 --> 14{ };\n  5 --> 16{ };\n"},"evals":[],"jsHooks":[]}</script><p class="caption">
SGConverter logic
</p>
</div>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://leeds-cdrc.github.io/nutrientprofiler/">nutrientprofiler</a></span><span class="op">)</span></span></code></pre></div>
<p>The central logic for specific gravity conversion is multiplying the
volume/weight of a product by a specific gravity multiplier. This is
distilled in he <code>generic_specific_gravity</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generic_specific_gravity.html">generic_specific_gravity</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1.01</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 101</span></span></code></pre></div>
<p>In practise this package uses the <code>SGtab</code> named vector
which contains a series of named products and their associated specific
gravity. This variable is not directly accessible to users but is used
by other specific gravity functions to determine the appropriate
specific gravity adjustments.</p>
<div class="section level2">
<h2 id="breaking-down-sgconverter">Breaking down <code>SGConverter</code><a class="anchor" aria-label="anchor" href="#breaking-down-sgconverter"></a>
</h2>
<p><code>SGConverter</code> works by taking the row of a data.frame as
it’s argument. It checks that row for a column called
<code>product_type</code>. This column is used to define whether the
product is either a <code>"food"</code> or <code>"drink"</code>. The
value in this column is used by <code>SGConverter</code> to determine
whether to pass the row to either an <code>sg_food_converter</code>
function or a <code>sg_drink_converter</code> function.</p>
<div class="section level3">
<h3 id="calculating-specific-gravity-for-food">Calculating specific gravity for food<a class="anchor" aria-label="anchor" href="#calculating-specific-gravity-for-food"></a>
</h3>
<p>If <code>SGConverter</code> is passed a <code>product_type</code>
that is <code>"food"</code> it passes the row to
<code>sg_food_converter</code>. This function does a simple test of
whether the row contains a column called <code>weight_g</code>, if this
column doesn’t contain <code>NA</code> it returns the value contained in
<code>weight_g</code> as we don’t have to adjust this for a specific
gravity. If the <code>weight_g</code> column does contain
<code>NA</code> the row is dispatches to the
<code>sg_liquidfood_converter</code> function. The
<code>sg_liquidfood_converter</code> checks for a <code>food_type</code>
column which contains a type value that should match a product included
in our <code>SGtab</code> vector. The
<code>sg_liquidfood_converter</code> checks if the
<code>food_type</code> column is not an empty string, if this is true it
calculates the specific gravity adjusted volume by getting the value
from the <code>volume_ml</code> column in the row and multiplying it by
the specific gravity value in the <code>SGtab</code> which is indexed
out of the vector using the <code>food_type</code> column value from the
passed row.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example of how sg_food_converter behaves</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>weight_g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>, </span>
<span>                  volume_ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>,  </span>
<span>                  product_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"food"</span>,<span class="st">"food"</span>,<span class="st">"food"</span><span class="op">)</span>, </span>
<span>                  food_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"Ice cream"</span>, <span class="st">"Semi-skimmed milk"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sg_food_converter.html">sg_food_converter</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100</span></span>
<span></span>
<span><span class="co"># on all rows with dplyr</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sg <span class="op">=</span> <span class="fu"><a href="../reference/sg_food_converter.html">sg_food_converter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;      sg</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   103</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-specific-gravity-for-drinks">Calculating specific gravity for drinks<a class="anchor" aria-label="anchor" href="#calculating-specific-gravity-for-drinks"></a>
</h3>
<p>The logic for calculating specific gravity for drinks is slightly
more complicated. If the <code>SGConverter</code> function found that
<code>"drink"</code> was specified in the <code>product_type</code>
column it dispatches the row to the <code>sg_drink_converter</code>
function. This checks the row for a column called
<code>drink_format</code> that specifies whether the drink is either:
ready to drink, a cordial or a powdered drink (<code>"ready"</code>,
<code>"cordial"</code>, <code>"powdered"</code>). For each of these
options the <code>sg_drink_converter</code> dispatches the row to an
additional function.</p>
<p>For <code>"ready"</code> it dispatches to
<code>sg_ready_drink_converter</code>. This function checks if the row
contains a <code>drink_type</code> column and if that row contains an
empty string. If it does not contain an empty string it calls the
<code>generic_specific_gravity</code> function passing the
<code>volume_ml</code> column value and the specific gravity multiplier
indexed from <code>SGtab</code> based on the value in
<code>drink_type</code>. If <code>drink_type</code> does contain an
empty string it just returns the <code>volume_ml</code> column
value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example of how sg_ready_drink_converter behaves</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>volume_ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                  drink_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Energy drink"</span>,<span class="st">"Ice cream"</span>, <span class="st">"Semi-skimmed milk"</span><span class="op">)</span><span class="op">)</span></span>
<span>             </span>
<span><span class="fu"><a href="../reference/sg_ready_drink_converter.html">sg_ready_drink_converter</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32.1</span></span>
<span></span>
<span><span class="co"># on all rows with dplyr</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sg <span class="op">=</span> <span class="fu"><a href="../reference/sg_ready_drink_converter.html">sg_ready_drink_converter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;      sg</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  32.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  13  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 103</span></span></code></pre></div>
<p>For <code>"cordial"</code> it dispatches to
<code>sg_cord_drink_converter</code>. This function checks the row for a
<code>nutrition_info</code> column to help determine how it should
proceed. This column contains information about how the drink has been
consumed, whether it has been directly consumed, following some
preparation instructions that dilute the cordial or if no instructions
were provided (<code>"as consumed"</code>,
<code>"preparation instructions given"</code>,
<code>"preparation instructions not given"</code>). If
<code>nutrition_info</code> is <code>"as consumed"</code> the
<code>volume_ml</code> column value and the specific gravity multipler
from the <code>SGtab</code> for
<code>"Cordial/squash ready to drink"</code> is passed to the
<code>generic_specific_gravity</code> function. For
<code>"preparation instructions given"</code> the expectation is that
there is an additional column in the row <code>volume_water_ml</code>
that specifies the volume of water used to dilute the cordial. If
<code>"preparation instructions given"</code> is found in
<code>nutrition_info</code> column it computes the sum of
<code>volume_ml</code> and <code>volume_water_ml</code> columns and
passes those to <code>generic_specific_gravity</code> along with the
specific gravity multipler from the <code>SGtab</code> for
<code>"Cordial/squash ready to drink"</code>. For
<code>"preparation instructions not given"</code> the
<code>volume_ml</code> column value is passed to
<code>generic_specific_gravity</code> function along with the specific
gravity multiplier indexed from <code>SGtab</code> for
<code>"Cordial/squash undiluted"</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example of how sg_cord_drink_converter behaves</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>volume_ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                   volume_water_ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                   nutrition_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"as consumed"</span>,<span class="st">"preparation instructions given"</span>, <span class="st">"preparation instructions not given"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sg_cord_drink_converter.html">sg_cord_drink_converter</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 30.9</span></span>
<span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sg <span class="op">=</span> <span class="fu"><a href="../reference/sg_cord_drink_converter.html">sg_cord_drink_converter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sg</span><span class="op">)</span>     </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;      sg</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  30.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 103  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 109</span></span></code></pre></div>
<p>If the <code>drink_format</code> column value is
<code>"powdered"</code> it dispatches to the
<code>sg_powd_drink_converter</code> function. This again checks the row
for values in the <code>nutrition_info</code> column to help determine
how to compute the specific gravity adjustment using the same 3
potential values defined above in the <code>cordial</code> section. If
<code>nutrition_info</code> is <code>"as consumed"</code> the
<code>volume_ml</code> column value and the specific gravity multipler
from the <code>SGtab</code> for
<code>"Cordial/squash ready to drink"</code> is passed to the
<code>generic_specific_gravity</code> function. For
<code>"preparation instructions given"</code> the expectation is that
there is an additional column in the row <code>weight_g</code> that
specifies the weight in grams of the powdered drink used. If
<code>"preparation instructions given"</code> is found in
<code>nutrition_info</code> column it computes the sum of
<code>weight_g</code> and <code>volume_water_ml</code> columns and
passes those to <code>generic_specific_gravity</code> along with the
specific gravity multipler from the <code>SGtab</code> for
<code>"Cordial/squash ready to drink"</code>. For
<code>"preparation instructions not given"</code> the
<code>weight_g</code> column value is returned unadjusted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example of how sg_powd_drink_converter behaves</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>volume_ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                   weight_g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                   volume_water_ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                   nutrition_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"as consumed"</span>,<span class="st">"preparation instructions given"</span>, <span class="st">"preparation instructions not given"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sg_powd_drink_converter.html">sg_powd_drink_converter</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 92.7</span></span>
<span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sg <span class="op">=</span> <span class="fu"><a href="../reference/sg_powd_drink_converter.html">sg_powd_drink_converter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sg</span><span class="op">)</span>     </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;      sg</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  92.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 103  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 100</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Overall most of the functions in <code>SGConverter</code> are quite
constrictive. They expect particular column names to work and won’t just
work with any data. However, the building blocks to all these functions
is the <code>generic_specific_gravity</code> which can be used to
develop your own functions for building a specific gravity conversion
pipeline. The existing steps shown here should serve as a template to
build your own specific gravity conversion pipeline.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alex Coleman, Vicki Jenneson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
