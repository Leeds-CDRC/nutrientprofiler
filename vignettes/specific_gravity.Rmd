---
title: "Specific Gravity Adjustment"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Specific Gravity Adjustment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

When attempting to calculate a Nutrient Profile Model volumes and masses need to
be adjusted by the specific gravity of the product to ensure a correct reading.
This is managed directly by the `SGConverter` high level function that operates
row-by-row on a data.frame with a series of expected columns. This function is
composed of a series of different dispatcher function which will be outlined
below (see figure for hierarchy).

```{r diagram-mermaid, fig.align='center', fig.cap="SGConverter logic", fig.dim=c(10, 6), echo=FALSE}
library(DiagrammeR)
DiagrammeR::mermaid("
graph TB;
  1(SGConverter<br>'product_type') --> 2(sg_food_converter<br>'weight_g');
  1 --> 3(sg_drink_converter<br>'drink_format');
  3 --> 4(sg_ready_drink_converter<br>'drink_type');
  3 --> 5(sg_powd_drink_converter<br>'nutrition_info');
  3 --> 6(sg_cord_drink_converter<br>'nutrition_info');
  6 --> 7{ };
  2 --> 10{ };
  2 --> 11(sg_liquidfood_converter<br>'food_type');
  11 --> 13{ };
  4 --> 14{ };
  5 --> 16{ };
")
```

```{r setup}
library(nutrientprofiler)
```

The central logic for specific gravity conversion is multiplying the
volume/weight of a product by a specific gravity multiplier. This is distilled
in he `generic_specific_gravity` function. 

```{r}
generic_specific_gravity(100, 1.01)
```

In practise this package uses the `SGtab` named vector which contains a series
of named products and their associated specific gravity. This variable is not
directly accessible to users but is used by other specific gravity functions to
determine the appropriate specific gravity adjustments.



